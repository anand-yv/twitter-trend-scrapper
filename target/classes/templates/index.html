<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Trending Topics</title>
</head>

<body>
    <h1>Welcome to Twitter Trending Scraper</h1>

    <h5 id="wait-time"></h5>

    <p id="timestamp"></p>

    <div id="trending-topics">
        <!-- Trending topics will be displayed here -->
    </div>

    <p id="ipaddress"></p>

    <h4 id="trend-json-heading" style="display: none;">Hereâ€™s a JSON extract of this record from the MongoDB:</h3>
        <p id="trend-json-data" style="white-space: pre-wrap;"></p>

        <a th:href="@{'/api/start'}" id="fetch-trends-link">Click here to run the script.</a>



        <script th:inline="javascript">
            document.getElementById('fetch-trends-link').addEventListener('click', function (event) {
                const waitTimer = document.getElementById('wait-time')
                waitTimer.innerHTML = "Please Wait for some time to Scrap the Trending Topics from Twitter";
                event.preventDefault(); // Prevent default link behavior
                fetch('/api/start')
                    .then(response => response.json())
                    .then(data => {
                        waitTimer.style.display = none;
                        const trendingDiv = document.getElementById('trending-topics');
                        trendingDiv.innerHTML = ''; // Clear previous topics
                        data['trends'].forEach((topic, index) => {
                            const topicElement = document.createElement('p');
                            topicElement.textContent = `Trending Topic ${index + 1}: ${topic}`;
                            trendingDiv.appendChild(topicElement);
                        });
                        // Append IP address information
                        const ipAddressParagraph = document.getElementById('ipaddress');
                        ipAddressParagraph.textContent = `The IP address used for this query was ${data['ipaddress']}.`;

                        // Format and display the date and time
                        const formattedDateTime = new Date(data['enDateTime']).toLocaleString('en-US', {
                            month: 'long',
                            day: 'numeric',
                            year: 'numeric',
                            hour: 'numeric',
                            minute: 'numeric'
                        });
                        const dateTimeParagraph = document.getElementById('timestamp');
                        dateTimeParagraph.textContent = `Date and time of end of Selenium Script: ${formattedDateTime}`;

                        fetch(`/trendsById?id=${data['id']}`)
                            .then(response => response.json())
                            .then(jsonData => {
                                const jsonOutput = document.getElementById('trend-json-data');
                                jsonOutput.textContent = JSON.stringify(jsonData, null, 2); // Pretty print JSON
                                document.getElementById('trend-json-heading').style.display = 'block';
                            })
                            .catch(error => console.error('Error fetching trend JSON:', error));

                        // Change link text
                        document.getElementById('fetch-trends-link').textContent = 'Click here to run the query again.';
                    })
                    .catch(error => console.error('Error fetching trending topics:', error));
            });

        </script>


</body>

</html>